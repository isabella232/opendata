{% set can_edit = h.check_access('package_update', {'id':pkg.id }) %}
{% set url_action = 'resource_edit' if (url_is_edit or draft) and can_edit else 'resource_read' %}
{% set url = h.url_for(controller='package', action=url_action, id=pkg.name, resource_id=res.id) %}

<li class="resource-item" data-id="{{ res.id }}">
  <div class="row">
    <div class="col-lg-8 col-md-8 col-sm-12">
      {% block resource_item_title %}

      <a class="heading " href="{{ url }}" title="{{ res.name or res.description }}">
        {{ h.resource_display_name(res) | truncate(50) }}
        <span class="format-label" property="dc:format" data-format="{{ res.format.lower() or 'data' }}">{{ res.format }}</span>
        {% if res.tracking_summary %}
        {{ h.popular('views', res.tracking_summary.total, min=10) }}
        {% endif %}
      </a>
      {% endblock %}

      <p class="description">
        {% set description = h.extra_translation(res, 'description', markdown=80) %}
        {% if description %}
          {{ description }}
        {% else %}
          <span class="empty">{{ _('No description for this resource') }}</span>
        {% endif %}
      </p>
    </div>
    <div class="col-lg-4 col-md-4 col-sm-12">
      {% block resource_item_explore %}
      {% if not url_is_edit %}
      <div class="dropdown btn-group">
        <a href="#" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
          <i class="icon-share-alt"></i>
          {{ _('Explore') }}
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
          {% block resource_item_explore_links %}
          <li>
            <a href="{{ url }}">
              {% if res.can_be_previewed %}
                <i class="icon-bar-chart"></i>
                {{ _('Preview') }}
              {% else %}
                <i class="icon-info-sign"></i>
                {{ _('More information') }}
              {% endif %}
            </a>
          </li>
          <li>
            <a href="{{ res.url }}" class="resource-url-analytics" target="_blank">
              {% if res.can_be_previewed %}
                <i class="icon-download"></i>
                {{ _('Download') }}
              {% else %}
                <i class="icon-external-link"></i>
                {{ _('Go to resource') }}
              {% endif %}
            </a>
          </li>
          <li>
            <a href="{{ res.url }}">
              {{ _('Download as CSV') }}
            </a>
          </li>
          {% if can_edit %}
          <li>
            <a href="{{ h.url_for(controller='package', action='resource_edit', id=pkg.name, resource_id=res.id) }}">
              <i class="icon-edit"></i>
              {{ _('Edit') }}
            </a>
          </li>
          {% endif %}
          {% endblock %}
        </ul>
      </div>
      {% endif %}
      {% endblock %}
    </div>
  </div>
</li>
